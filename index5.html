<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 1400px;
            height: 90%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .login-section, .dashboard {
            display: none;
        }

        .login-section.active, .dashboard.active {
            display: block;
        }

        .login-box {
            max-width: 400px;
            margin: 0 auto;
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            margin-top: 10px;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-small {
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .dashboard-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            flex: 1;
            min-width: 150px;
            padding: 12px 20px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #333;
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-right: 4px solid #667eea;
        }

        .info-item label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .info-item span {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            font-size: 14px;
        }

        th, td {
            padding: 12px 8px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
            font-size: 13px;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .grade-input {
            width: 80px;
            padding: 6px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            text-align: center;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-buttons button {
            flex: 1;
            min-width: 150px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-card h4 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .homework-item, .prep-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-right: 4px solid #667eea;
        }

        .homework-item strong, .prep-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
        }

        .homework-item small, .prep-item small {
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .code-display {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
            margin: 20px 0;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .backup-card {
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .backup-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .backup-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .backup-icon {
            font-size: 48px;
            line-height: 1;
        }

        .backup-subtitle {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .backup-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-right: 4px solid #667eea;
        }

        .section-title {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .danger-card {
            border-color: #dc3545;
        }

        .danger-card:hover {
            border-color: #c82333;
            box-shadow: 0 5px 20px rgba(220, 53, 69, 0.2);
        }

        .danger-card .backup-header {
            border-bottom-color: #dc3545;
        }

        .danger-section {
            background: #fff5f5;
            border-right-color: #dc3545;
        }

        .danger-section .section-title {
            color: #dc3545;
        }

        .btn-icon {
            margin-left: 8px;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .container {
                height: 100%;
                border-radius: 0;
            }

            .header h1 {
                font-size: 22px;
            }

            .content {
                padding: 20px;
            }

            .dashboard-nav {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons button {
                width: 100%;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1>Ù…Ø±ÙƒØ² Ø§Ù„Ø­Ø¨ÙŠØ¨ Ù„Ù„Ø£Ù„Ø­Ø§Ù† ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</h1>
    <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„ Ù„Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† ÙˆØ§Ù„Ø®Ø¯Ø§Ù…</p>
   </div>
   <div class="content">
    <div id="alertBox" class="alert"></div>
    <div id="loadingBox" class="loading">
     <div class="spinner"></div>
     <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div><!-- Login Section -->
    <div class="login-section active" id="loginSection">
     <div class="login-box">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <form id="loginForm">
       <div class="form-group"><label for="userType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label> <select id="userType" required> <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</option> <option value="student">Ø¯Ø§Ø±Ø³</option> <option value="teacher">Ø®Ø§Ø¯Ù…</option> <option value="control">Ù…Ø³Ø¤ÙˆÙ„</option> </select>
       </div>
       <div class="form-group"><label for="userCode">Ø§Ù„ÙƒÙˆØ¯</label> <input type="text" id="userCode" placeholder="Ù…Ø«Ø§Ù„: DQ34ZA54" required>
       </div>
       <div class="form-group" id="passwordGroup" style="display: none;"><label for="userPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> <input type="password" id="userPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
       </div><button type="submit" class="btn" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
      </form>
     </div>
    </div><!-- Student Dashboard -->
    <div class="dashboard" id="studentDashboard">
     <div class="dashboard-nav"><button class="nav-btn active" onclick="showSection('studentInfo')">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</button> <button class="nav-btn" onclick="showSection('studentGrades')">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</button> <button class="nav-btn" onclick="showSection('studentHomework')">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</button> <button class="nav-btn" onclick="showSection('studentResults')">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button> <button class="btn-secondary btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
     </div>
     <div id="studentInfo" class="section active">
      <div class="card">
       <h3>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
       <div class="info-grid" id="studentInfoGrid"></div>
      </div>
     </div>
     <div id="studentGrades" class="section">
      <div class="card">
       <h3>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h3>
       <div class="table-container" id="studentGradesTable"></div>
      </div>
     </div>
     <div id="studentHomework" class="section">
      <div class="card">
       <h3>Ø±ÙØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h3>
       <div class="form-group"><label for="homeworkType">Ù†ÙˆØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨</label> <select id="homeworkType"> <option value="coptic">Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</option> <option value="rituals">Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©</option> <option value="hymns">ØªØ³Ù…ÙŠØ¹ Ø§Ù„Ø£Ù„Ø­Ø§Ù†</option> </select>
       </div>
       <div class="form-group"><label for="homeworkNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label> <input type="text" id="homeworkNotes" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
       </div><button class="btn" onclick="submitHomework()">ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨</button>
       <div id="homeworkList" style="margin-top: 20px;"></div>
      </div>
     </div>
     <div id="studentResults" class="section">
      <div class="card">
       <h3>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
       <div class="table-container" id="studentResultsTable"></div>
      </div>
     </div>
    </div><!-- Teacher Dashboard -->
    <div class="dashboard" id="teacherDashboard">
     <div class="dashboard-nav"><button class="nav-btn active" onclick="showSection('teacherInfo')">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</button> <button class="nav-btn" onclick="showSection('teacherAttendance')">Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</button> <button class="nav-btn" onclick="showSection('teacherPreparation')">Ø§Ù„ØªØ­Ø¶ÙŠØ±</button> <button class="nav-btn" onclick="showSection('teacherGrading')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button> <button class="btn-secondary btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
     </div>
     <div id="teacherInfo" class="section active">
      <div class="card">
       <h3>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
       <div class="info-grid" id="teacherInfoGrid"></div>
      </div>
     </div>
     <div id="teacherAttendance" class="section">
      <div class="card">
       <h3>ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h3>
       <div class="table-container" id="attendanceTable"></div><button class="btn" onclick="saveAttendance()">Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
      </div>
     </div>
     <div id="teacherPreparation" class="section">
      <div class="card">
       <h3>Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
       <div class="form-group"><label for="prepNotes">Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø³</label> <textarea id="prepNotes" placeholder="Ø£Ø¯Ø®Ù„ Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©"></textarea>
       </div><button class="btn" onclick="savePreparation()">Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>
       <div id="prepList" style="margin-top: 20px;"></div>
      </div>
     </div>
     <div id="teacherGrading" class="section">
      <div class="card">
       <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h3>
       <div class="form-group"><label for="gradeSubject">Ø§Ù„Ù…Ø§Ø¯Ø©</label> <select id="gradeSubject"> <option value="coptic">Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</option> <option value="rituals">Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©</option> <option value="hymns">Ø§Ù„Ø£Ù„Ø­Ø§Ù†</option> </select>
       </div>
       <div class="table-container" id="gradingTable"></div><button class="btn" onclick="saveGrades()">Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button>
      </div>
     </div>
    </div><!-- Control Dashboard -->
    <div class="dashboard" id="controlDashboard">
     <div class="dashboard-nav"><button class="nav-btn active" onclick="showSection('controlStats')">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button> <button class="nav-btn" onclick="showSection('controlStudents')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</button> <button class="nav-btn" onclick="showSection('controlTeachers')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø¯Ø§Ù…</button> <button class="nav-btn" onclick="showSection('controlResults')">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</button> <button class="nav-btn" onclick="showSection('controlBackup')">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button> <button class="btn-secondary btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
     </div>
     <div id="controlStats" class="section active">
      <div class="stats-grid" id="statsGrid"></div>
      <div class="card">
       <h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
       <div class="action-buttons"><button class="btn" onclick="exportReport('students')">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</button> <button class="btn" onclick="exportReport('grades')">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button> <button class="btn" onclick="exportReport('attendance')">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</button>
       </div>
      </div>
     </div>
     <div id="controlStudents" class="section">
      <div class="card">
       <h3>Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h3>
       <form id="addStudentForm">
        <div class="info-grid">
         <div class="form-group"><label for="studentType">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³</label> <select id="studentType" required> <option value="Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯">Ø¯Ø§Ø±Ø³ Ø¬Ø¯ÙŠØ¯</option> <option value="Ø¯Ø§Ø±Ø³ Ù‚Ø¯ÙŠÙ…">Ø¯Ø§Ø±Ø³ Ù‚Ø¯ÙŠÙ…</option> </select>
         </div>
         <div class="form-group"><label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label> <input type="text" id="studentName" required>
         </div>
         <div class="form-group"><label for="studentGender">Ø§Ù„Ù†ÙˆØ¹</label> <select id="studentGender" required> <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option> <option value="Ø£Ù†Ø«ÙŠ">Ø£Ù†Ø«ÙŠ</option> </select>
         </div>
         <div class="form-group"><label for="studentBirthdate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label> <input type="date" id="studentBirthdate" required>
         </div>
         <div class="form-group"><label for="studentStage">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label> <select id="studentStage" required> <option value="KG1">KG1</option> <option value="KG2">KG2</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø£Ø¨ØªØ¯Ø§Ø¦ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option> <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option> <option value="Ø´Ø¨Ø§Ø¨">Ø´Ø¨Ø§Ø¨</option> <option value="Ø®Ø±ÙŠØ¬ÙŠÙ†">Ø®Ø±ÙŠØ¬ÙŠÙ†</option> <option value="Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø£Ù…ÙˆØ±">Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø£Ù…ÙˆØ±</option> </select>
         </div>
         <div class="form-group"><label for="studentPhone1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1</label> <input type="tel" id="studentPhone1" required>
         </div>
         <div class="form-group"><label for="studentPhone2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2</label> <input type="tel" id="studentPhone2">
         </div>
         <div class="form-group"><label for="studentClassLetter">Ø­Ø±Ù Ø§Ù„ÙØµÙ„</label> <select id="studentClassLetter" required> <option value="A">A</option> <option value="B">B</option> <option value="C">C</option> <option value="D">D</option> </select>
         </div>
         <div class="form-group"><label for="studentClass">Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²</label> <select id="studentClass" required> <option value="ØªÙ…Ù‡ÙŠØ¯ÙŠ">ØªÙ…Ù‡ÙŠØ¯ÙŠ</option> <option value="Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©">Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©</option> <option value="Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©">Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©</option> <option value="Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©">Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©</option> <option value="Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ">Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ</option> <option value="Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†">Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†</option> </select>
         </div>
         <div class="form-group"><label for="studentRank">Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©</label> <input type="text" id="studentRank" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨ØµØ§Ù„ØªÙˆØ³">
         </div>
         <div class="form-group"><label for="studentAddress">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label> <input type="text" id="studentAddress">
         </div>
         <div class="form-group"><label for="studentForm">Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label> <select id="studentForm"> <option value="TRUE">Ù†Ø¹Ù…</option> <option value="FALSE">Ù„Ø§</option> </select>
         </div>
         <div class="form-group"><label for="studentPhoto">Ø§Ù„ØµÙˆØ±Ø©</label> <select id="studentPhoto"> <option value="TRUE">Ù†Ø¹Ù…</option> <option value="FALSE">Ù„Ø§</option> </select>
         </div>
         <div class="form-group"><label for="studentFormValue">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label> <select id="studentFormValue"> <option value="TRUE">Ù…Ø¯ÙÙˆØ¹Ø©</option> <option value="FALSE">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©</option> </select>
         </div>
        </div><button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø±Ø³</button>
       </form>
      </div>
      <div class="card">
       <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h3>
       <div class="table-container" id="studentsListTable"></div>
      </div>
     </div>
     <div id="controlTeachers" class="section">
      <div class="card">
       <h3>Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
       <form id="addTeacherForm">
        <div class="info-grid">
         <div class="form-group"><label for="teacherName">Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…</label> <input type="text" id="teacherName" required>
         </div>
         <div class="form-group"><label for="teacherPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label> <input type="tel" id="teacherPhone" required>
         </div>
         <div class="form-group"><label for="teacherSpec">Ø§Ù„ØªØ®ØµØµ</label> <select id="teacherSpec" required> <option value="Ø£Ø¯Ø§Ø±ÙŠ">Ø£Ø¯Ø§Ø±ÙŠ</option> <option value="Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³">Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³</option> <option value="Ø¯Ø±Ø§Ø³ÙŠ - Ù„ØºØ© Ù‚Ø¨Ø·ÙŠØ©">Ø¯Ø±Ø§Ø³ÙŠ - Ù„ØºØ© Ù‚Ø¨Ø·ÙŠØ©</option> <option value="Ø¯Ø±Ø§Ø³ÙŠ - Ø§Ù„Ø­Ø§Ù†">Ø¯Ø±Ø§Ø³ÙŠ - Ø§Ù„Ø­Ø§Ù†</option> <option value="Ø¯Ø±Ø§Ø³ÙŠ Ù…Ø­ÙÙˆØ¸Ø§Øª">Ø¯Ø±Ø§Ø³ÙŠ Ù…Ø­ÙÙˆØ¸Ø§Øª</option> <option value="Ù…Ø³Ø¤ÙˆÙ„">Ù…Ø³Ø¤ÙˆÙ„</option> <option value="Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³ ÙˆÙ…Ø­ÙÙˆØ¸Ø§Øª">Ø¯Ø±Ø§Ø³ÙŠ - Ø·Ù‚ÙˆØ³ ÙˆÙ…Ø­ÙÙˆØ¸Ø§Øª</option> <option value="Ø£Ø¯Ø§Ø±ÙŠ - Ø¯Ø±Ø§Ø³ÙŠ">Ø£Ø¯Ø§Ø±ÙŠ - Ø¯Ø±Ø§Ø³ÙŠ</option> </select>
         </div>
         <div class="form-group"><label for="teacherAdmin">Ø§Ø¯Ø§Ø±ÙŠ</label> <select id="teacherAdmin"> <option value="TRUE">Ù†Ø¹Ù…</option> <option value="FALSE">Ù„Ø§</option> </select>
         </div>
         <div class="form-group"><label for="teacherPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> <input type="password" id="teacherPassword" required>
         </div>
         <div class="form-group"><label for="teacherClass">Ø§Ù„ÙØµÙ„</label> <select id="teacherClass"> <option value="ØªÙ…Ù‡ÙŠØ¯ÙŠ">ØªÙ…Ù‡ÙŠØ¯ÙŠ</option> <option value="Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©">Ø£ÙˆÙ„ÙŠ ÙˆØ«Ø§Ù†ÙŠØ©</option> <option value="Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©">Ø«Ø§Ù„Ø«Ø© ÙˆØ±Ø§Ø¨Ø¹Ø©</option> <option value="Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©">Ø®Ø§Ù…Ø³Ø© ÙˆØ³Ø§Ø¯Ø³Ø©</option> <option value="Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ">Ø£Ø¹Ø¯Ø§Ø¯ÙŠ - Ø«Ø§Ù†ÙˆÙŠ</option> <option value="Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†">Ø´Ø¨Ø§Ø¨ ÙˆØ®Ø±ÙŠØ¬ÙŠÙ†</option> </select>
         </div>
        </div><button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ø®Ø§Ø¯Ù…</button>
       </form>
      </div>
      <div class="card">
       <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø¯Ø§Ù…</h3>
       <div class="table-container" id="teachersListTable"></div>
      </div>
     </div>
     <div id="controlResults" class="section">
      <div class="card">
       <h3>Ø¥Ø¶Ø§ÙØ© Ù†ØªÙŠØ¬Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
       <form id="addResultForm">
        <div class="info-grid">
         <div class="form-group"><label for="resultStudent">Ø§Ù„Ø¯Ø§Ø±Ø³</label> <select id="resultStudent" required></select>
         </div>
         <div class="form-group"><label for="resultTerm">Ø§Ù„ØªØ±Ù…</label> <input type="text" id="resultTerm" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØªØ±Ù… Ø§Ù„Ø£ÙˆÙ„ 2024" required>
         </div>
         <div class="form-group"><label for="resultMidterm">Midterm</label> <input type="number" id="resultMidterm" min="0" max="100" required>
         </div>
         <div class="form-group"><label for="resultFinal">Final</label> <input type="number" id="resultFinal" min="0" max="100" required>
         </div>
        </div><button type="submit" class="btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
       </form>
      </div>
      <div class="card">
       <h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
       <div class="table-container" id="allResultsTable"></div>
      </div>
     </div>
     <div id="controlBackup" class="section">
      <div class="alert alert-warning show"><strong>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡:</strong> ÙŠØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…ØªØµÙØ­Ùƒ (LocalStorage). ÙŠÙÙ†ØµØ­ Ø¨Ø¹Ù…Ù„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ.
      </div><!-- Students Backup Section -->
      <div class="card backup-card">
       <div class="backup-header">
        <div class="backup-icon">
         ğŸ‘¥
        </div>
        <div>
         <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h3>
         <p class="backup-subtitle">ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† ÙÙ‚Ø·</p>
        </div>
       </div>
       <div class="backup-section">
        <h4 class="section-title">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h4>
        <div class="action-buttons"><button class="btn btn-success" onclick="exportStudentsToExcel()"> <span class="btn-icon">ğŸ“Š</span> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel </button> <button class="btn btn-success" onclick="exportStudentsJSON()"> <span class="btn-icon">ğŸ“„</span> ØªØµØ¯ÙŠØ± JSON </button>
        </div>
       </div>
       <div class="backup-section">
        <h4 class="section-title">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h4>
        <div class="action-buttons"><button class="btn" onclick="document.getElementById('importStudentsExcel').click()"> <span class="btn-icon">ğŸ“Š</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel </button> <button class="btn" onclick="document.getElementById('importStudentsJSON').click()"> <span class="btn-icon">ğŸ“„</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON </button>
        </div><input type="file" id="importStudentsExcel" accept=".xlsx,.xls" style="display: none;" onchange="importStudentsFromExcel(event)"> <input type="file" id="importStudentsJSON" accept=".json" style="display: none;" onchange="importStudentsFromJSON(event)">
       </div>
      </div><!-- Teachers Backup Section -->
      <div class="card backup-card">
       <div class="backup-header">
        <div class="backup-icon">
         ğŸ‘¨â€ğŸ«
        </div>
        <div>
         <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø®Ø¯Ø§Ù…</h3>
         <p class="backup-subtitle">ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù… ÙÙ‚Ø·</p>
        </div>
       </div>
       <div class="backup-section">
        <h4 class="section-title">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù…</h4>
        <div class="action-buttons"><button class="btn btn-success" onclick="exportTeachersToExcel()"> <span class="btn-icon">ğŸ“Š</span> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel </button> <button class="btn btn-success" onclick="exportTeachersJSON()"> <span class="btn-icon">ğŸ“„</span> ØªØµØ¯ÙŠØ± JSON </button>
        </div>
       </div>
       <div class="backup-section">
        <h4 class="section-title">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù…</h4>
        <div class="action-buttons"><button class="btn" onclick="document.getElementById('importTeachersExcel').click()"> <span class="btn-icon">ğŸ“Š</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel </button> <button class="btn" onclick="document.getElementById('importTeachersJSON').click()"> <span class="btn-icon">ğŸ“„</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON </button>
        </div><input type="file" id="importTeachersExcel" accept=".xlsx,.xls" style="display: none;" onchange="importTeachersFromExcel(event)"> <input type="file" id="importTeachersJSON" accept=".json" style="display: none;" onchange="importTeachersFromJSON(event)">
       </div>
      </div><!-- Complete Backup Section -->
      <div class="card backup-card danger-card">
       <div class="backup-header">
        <div class="backup-icon">
         ğŸ—„ï¸
        </div>
        <div>
         <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„</h3>
         <p class="backup-subtitle">ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¯Ø§Ø±Ø³ÙŠÙ†ØŒ Ø®Ø¯Ø§Ù…ØŒ Ø¯Ø±Ø¬Ø§ØªØŒ Ø­Ø¶ÙˆØ±ØŒ Ø¥Ù„Ø®)</p>
        </div>
       </div>
       <div class="backup-section">
        <h4 class="section-title">ğŸ“¤ ØªØµØ¯ÙŠØ± ÙƒØ§Ù…Ù„</h4>
        <div class="action-buttons"><button class="btn btn-success" onclick="exportToExcel()"> <span class="btn-icon">ğŸ“Š</span> ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„ Ø¥Ù„Ù‰ Excel </button> <button class="btn btn-success" onclick="exportCompleteJSON()"> <span class="btn-icon">ğŸ“„</span> ØªØµØ¯ÙŠØ± Ø§Ù„ÙƒÙ„ JSON </button>
        </div>
       </div>
       <div class="backup-section">
        <h4 class="section-title">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙƒØ§Ù…Ù„</h4>
        <div class="action-buttons"><button class="btn" onclick="document.getElementById('importExcelFile').click()"> <span class="btn-icon">ğŸ“Š</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙƒÙ„ Ù…Ù† Excel </button> <button class="btn" onclick="document.getElementById('importCompleteJSON').click()"> <span class="btn-icon">ğŸ“„</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ÙƒÙ„ JSON </button>
        </div><input type="file" id="importExcelFile" accept=".xlsx,.xls" style="display: none;" onchange="importFromExcel(event)"> <input type="file" id="importCompleteJSON" accept=".json" style="display: none;" onchange="importCompleteJSON(event)">
       </div>
       <div class="backup-section danger-section">
        <h4 class="section-title">âš ï¸ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</h4><button class="btn btn-danger" onclick="clearAllData()"> <span class="btn-icon">ğŸ—‘ï¸</span> Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ </button>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Generate unique code like DQ34ZA54
        function generateCode(prefix) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = prefix;
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // LocalStorage Database Manager
        const DB = {
            get: function(key) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            },
            set: function(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            },
            add: function(key, item) {
                const data = this.get(key);
                item.id = Date.now().toString(36) + Math.random().toString(36).substr(2);
                data.push(item);
                this.set(key, data);
                return item;
            },
            update: function(key, id, updates) {
                const data = this.get(key);
                const index = data.findIndex(item => item.id === id);
                if (index !== -1) {
                    data[index] = { ...data[index], ...updates };
                    this.set(key, data);
                    return data[index];
                }
                return null;
            },
            delete: function(key, id) {
                const data = this.get(key);
                const filtered = data.filter(item => item.id !== id);
                this.set(key, filtered);
            },
            clear: function(key) {
                localStorage.removeItem(key);
            }
        };

        let currentUser = null;

        // Initialize default control user if not exists
        function initializeSystem() {
            const teachers = DB.get('teachers');
            if (teachers.length === 0) {
                DB.add('teachers', {
                    type: 'control',
                    code: 'ADMIN',
                    name: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„',
                    phone: '01000000000',
                    specialization: 'Ù…Ø³Ø¤ÙˆÙ„',
                    admin: 'TRUE',
                    password: 'admin123',
                    class: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„'
                });
                showAlert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø§Ù„ÙƒÙˆØ¯: ADMIN | ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: admin123', 'success');
            }
        }

        // Login Handler
        document.getElementById('userType').addEventListener('change', function() {
            const passwordGroup = document.getElementById('passwordGroup');
            if (this.value === 'teacher' || this.value === 'control') {
                passwordGroup.style.display = 'block';
                document.getElementById('userPassword').required = true;
            } else {
                passwordGroup.style.display = 'none';
                document.getElementById('userPassword').required = false;
            }
        });

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const userType = document.getElementById('userType').value;
            const userCode = document.getElementById('userCode').value.trim().toUpperCase();
            const userPassword = document.getElementById('userPassword').value;

            let user = null;

            if (userType === 'student') {
                const students = DB.get('students');
                user = students.find(s => s.code === userCode);
            } else {
                const teachers = DB.get('teachers');
                user = teachers.find(t => t.code === userCode && t.type === userType);
                
                if (user && user.password !== userPassword) {
                    showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    return;
                }
            }

            if (!user) {
                showAlert('Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                return;
            }

            currentUser = user;
            showDashboard(userType);
        });

        function showDashboard(type) {
            document.getElementById('loginSection').classList.remove('active');
            
            if (type === 'student') {
                document.getElementById('studentDashboard').classList.add('active');
                loadStudentData();
            } else if (type === 'teacher') {
                document.getElementById('teacherDashboard').classList.add('active');
                loadTeacherData();
            } else if (type === 'control') {
                document.getElementById('controlDashboard').classList.add('active');
                loadControlData();
            }
        }

        // Student Functions
        function loadStudentData() {
            const infoGrid = document.getElementById('studentInfoGrid');
            infoGrid.innerHTML = `
                <div class="info-item">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³</label>
                    <span>${currentUser.studentType}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„ÙƒÙˆØ¯</label>
                    <span>${currentUser.code}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„Ø§Ø³Ù…</label>
                    <span>${currentUser.name}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„Ù†ÙˆØ¹</label>
                    <span>${currentUser.gender}</span>
                </div>
                <div class="info-item">
                    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                    <span>${new Date(currentUser.birthdate).toLocaleDateString('ar-EG')}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
                    <span>${currentUser.stage}</span>
                </div>
                <div class="info-item">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1</label>
                    <span>${currentUser.phone1}</span>
                </div>
                ${currentUser.phone2 ? `
                <div class="info-item">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2</label>
                    <span>${currentUser.phone2}</span>
                </div>` : ''}
                <div class="info-item">
                    <label>Ø­Ø±Ù Ø§Ù„ÙØµÙ„</label>
                    <span>${currentUser.classLetter}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²</label>
                    <span>${currentUser.class}</span>
                </div>
                ${currentUser.rank ? `
                <div class="info-item">
                    <label>Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©</label>
                    <span>${currentUser.rank}</span>
                </div>` : ''}
                ${currentUser.address ? `
                <div class="info-item">
                    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                    <span>${currentUser.address}</span>
                </div>` : ''}
                <div class="info-item">
                    <label>Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label>
                    <span class="badge ${currentUser.form === 'TRUE' ? 'badge-success' : 'badge-danger'}">${currentUser.form === 'TRUE' ? 'Ù…Ø³ØªÙ„Ù…Ø©' : 'ØºÙŠØ± Ù…Ø³ØªÙ„Ù…Ø©'}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„ØµÙˆØ±Ø©</label>
                    <span class="badge ${currentUser.photo === 'TRUE' ? 'badge-success' : 'badge-danger'}">${currentUser.photo === 'TRUE' ? 'Ù…Ø³ØªÙ„Ù…Ø©' : 'ØºÙŠØ± Ù…Ø³ØªÙ„Ù…Ø©'}</span>
                </div>
                <div class="info-item">
                    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</label>
                    <span class="badge ${currentUser.formValue === 'TRUE' ? 'badge-success' : 'badge-danger'}">${currentUser.formValue === 'TRUE' ? 'Ù…Ø¯ÙÙˆØ¹Ø©' : 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©'}</span>
                </div>
            `;

            // Load Grades
            const grades = DB.get('grades').filter(g => g.studentCode === currentUser.code);
            const gradesTable = document.getElementById('studentGradesTable');
            if (grades.length > 0) {
                gradesTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©</th>
                                <th>Ø§Ù„Ø·Ù‚ÙˆØ³</th>
                                <th>Ø§Ù„Ø£Ù„Ø­Ø§Ù†</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${grades.map(g => `
                                <tr>
                                    <td>${new Date(g.date).toLocaleDateString('ar-EG')}</td>
                                    <td>${g.coptic || '-'}</td>
                                    <td>${g.rituals || '-'}</td>
                                    <td>${g.hymns || '-'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                gradesTable.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p></div>';
            }

            // Load Homework
            const homework = DB.get('homework').filter(h => h.studentCode === currentUser.code);
            const homeworkList = document.getElementById('homeworkList');
            if (homework.length > 0) {
                homeworkList.innerHTML = `
                    <h4 style="margin-top: 20px; color: #667eea;">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ù„Ù…Ø©:</h4>
                    ${homework.map(h => `
                        <div class="homework-item">
                            <strong>${h.type === 'coptic' ? 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©' : h.type === 'rituals' ? 'Ø§Ù„Ø·Ù‚ÙˆØ³ Ø§Ù„ÙƒÙ†Ø³ÙŠØ©' : 'ØªØ³Ù…ÙŠØ¹ Ø§Ù„Ø£Ù„Ø­Ø§Ù†'}</strong>
                            <p>${h.notes}</p>
                            <small>${new Date(h.date).toLocaleString('ar-EG')}</small>
                        </div>
                    `).join('')}
                `;
            } else {
                homeworkList.innerHTML = '';
            }

            // Load Results
            const results = DB.get('results').filter(r => r.studentCode === currentUser.code);
            const resultsTable = document.getElementById('studentResultsTable');
            if (results.length > 0) {
                resultsTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ±Ù…</th>
                                <th>Midterm</th>
                                <th>Final</th>
                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${results.map(r => `
                                <tr>
                                    <td>${r.term}</td>
                                    <td>${r.midterm}</td>
                                    <td>${r.final}</td>
                                    <td><strong>${r.midterm + r.final}</strong></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                resultsTable.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p></div>';
            }
        }

        function submitHomework() {
            const type = document.getElementById('homeworkType').value;
            const notes = document.getElementById('homeworkNotes').value || 'ÙˆØ§Ø¬Ø¨ ' + (type === 'coptic' ? 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©' : type === 'rituals' ? 'Ø§Ù„Ø·Ù‚ÙˆØ³' : 'Ø§Ù„Ø£Ù„Ø­Ø§Ù†');

            DB.add('homework', {
                studentCode: currentUser.code,
                studentName: currentUser.name,
                type: type,
                notes: notes,
                date: new Date().toISOString()
            });

            showAlert('ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            document.getElementById('homeworkNotes').value = '';
            loadStudentData();
        }

        // Teacher Functions
        function loadTeacherData() {
            const infoGrid = document.getElementById('teacherInfoGrid');
            infoGrid.innerHTML = `
                <div class="info-item">
                    <label>Ø§Ù„ÙƒÙˆØ¯</label>
                    <span>${currentUser.code}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„Ø§Ø³Ù…</label>
                    <span>${currentUser.name}</span>
                </div>
                <div class="info-item">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <span>${currentUser.phone}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„ØªØ®ØµØµ</label>
                    <span>${currentUser.specialization}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ø¯Ø§Ø±ÙŠ</label>
                    <span class="badge ${currentUser.admin === 'TRUE' ? 'badge-success' : 'badge-danger'}">${currentUser.admin === 'TRUE' ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</span>
                </div>
                <div class="info-item">
                    <label>Ø§Ù„ÙØµÙ„</label>
                    <span>${currentUser.class}</span>
                </div>
            `;

            // Load Students for Attendance
            const students = DB.get('students');
            const attendanceTable = document.getElementById('attendanceTable');
            if (students.length > 0) {
                attendanceTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ÙƒÙˆØ¯</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                <th>Ø§Ù„ÙØµÙ„</th>
                                <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${students.map(s => `
                                <tr>
                                    <td>${s.code}</td>
                                    <td>${s.name}</td>
                                    <td>${s.stage}</td>
                                    <td>${s.class}</td>
                                    <td>
                                        <select class="grade-input" data-student="${s.code}">
                                            <option value="present">Ø­Ø§Ø¶Ø±</option>
                                            <option value="absent">ØºØ§Ø¦Ø¨</option>
                                            <option value="excused">Ù…Ø¹ØªØ°Ø±</option>
                                        </select>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                attendanceTable.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</p></div>';
            }

            // Load Preparation
            const prep = DB.get('preparation').filter(p => p.teacherCode === currentUser.code);
            const prepList = document.getElementById('prepList');
            if (prep.length > 0) {
                prepList.innerHTML = `
                    <h4 style="margin-top: 20px; color: #667eea;">Ø§Ù„ØªØ­Ø¶ÙŠØ±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</h4>
                    ${prep.map(p => `
                        <div class="prep-item">
                            <strong>ØªØ­Ø¶ÙŠØ± ${new Date(p.date).toLocaleDateString('ar-EG')}</strong>
                            <p>${p.notes}</p>
                            <small>${new Date(p.date).toLocaleString('ar-EG')}</small>
                        </div>
                    `).join('')}
                `;
            } else {
                prepList.innerHTML = '';
            }

            // Load Students for Grading
            const gradingTable = document.getElementById('gradingTable');
            if (students.length > 0) {
                gradingTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ÙƒÙˆØ¯</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                <th>Ø§Ù„ÙØµÙ„</th>
                                <th>Ø§Ù„Ø¯Ø±Ø¬Ø© (Ù…Ù† 100)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${students.map(s => `
                                <tr>
                                    <td>${s.code}</td>
                                    <td>${s.name}</td>
                                    <td>${s.stage}</td>
                                    <td>${s.class}</td>
                                    <td>
                                        <input type="number" class="grade-input" min="0" max="100" 
                                               data-student="${s.code}" placeholder="0-100">
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                gradingTable.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</p></div>';
            }
        }

        function saveAttendance() {
            const selects = document.querySelectorAll('#attendanceTable select');
            let count = 0;

            selects.forEach(select => {
                const studentCode = select.dataset.student;
                const attendance = select.value;

                DB.add('attendance', {
                    studentCode: studentCode,
                    teacherCode: currentUser.code,
                    attendance: attendance,
                    date: new Date().toISOString()
                });
                count++;
            });

            showAlert(`ØªÙ… Ø­ÙØ¸ Ø­Ø¶ÙˆØ± ${count} Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }

        function savePreparation() {
            const notes = document.getElementById('prepNotes').value.trim();
            if (!notes) {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø³', 'error');
                return;
            }

            DB.add('preparation', {
                teacherCode: currentUser.code,
                teacherName: currentUser.name,
                notes: notes,
                date: new Date().toISOString()
            });

            showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
            document.getElementById('prepNotes').value = '';
            loadTeacherData();
        }

        function saveGrades() {
            const subject = document.getElementById('gradeSubject').value;
            const inputs = document.querySelectorAll('#gradingTable input');
            let count = 0;

            inputs.forEach(input => {
                const grade = parseInt(input.value);
                if (!grade || grade < 0 || grade > 100) return;

                const studentCode = input.dataset.student;
                const gradeData = {
                    studentCode: studentCode,
                    teacherCode: currentUser.code,
                    date: new Date().toISOString()
                };

                if (subject === 'coptic') gradeData.coptic = grade;
                else if (subject === 'rituals') gradeData.rituals = grade;
                else if (subject === 'hymns') gradeData.hymns = grade;

                DB.add('grades', gradeData);
                count++;
            });

            if (count > 0) {
                showAlert(`ØªÙ… Ø­ÙØ¸ Ø¯Ø±Ø¬Ø§Øª ${count} Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                document.querySelectorAll('#gradingTable input').forEach(i => i.value = '');
            } else {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹', 'error');
            }
        }

        // Control Functions
        function loadControlData() {
            const students = DB.get('students');
            const teachers = DB.get('teachers').filter(t => t.type !== 'control');
            const grades = DB.get('grades');
            const attendance = DB.get('attendance');

            // Stats
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†</h4>
                    <div class="number">${students.length}</div>
                </div>
                <div class="stat-card">
                    <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø¯Ø§Ù…</h4>
                    <div class="number">${teachers.length}</div>
                </div>
                <div class="stat-card">
                    <h4>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h4>
                    <div class="number">${grades.length}</div>
                </div>
                <div class="stat-card">
                    <h4>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h4>
                    <div class="number">${attendance.length}</div>
                </div>
            `;

            // Students List
            const studentsTable = document.getElementById('studentsListTable');
            if (students.length > 0) {
                studentsTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ÙƒÙˆØ¯</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                <th>Ø§Ù„ÙØµÙ„</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${students.map(s => `
                                <tr>
                                    <td><strong>${s.code}</strong></td>
                                    <td>${s.name}</td>
                                    <td>${s.gender}</td>
                                    <td>${s.stage}</td>
                                    <td>${s.classLetter} - ${s.class}</td>
                                    <td>${s.phone1}</td>
                                    <td><span class="badge ${s.formValue === 'TRUE' ? 'badge-success' : 'badge-danger'}">${s.formValue === 'TRUE' ? 'Ù…Ø¯ÙÙˆØ¹Ø©' : 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©'}</span></td>
                                    <td>
                                        <button class="delete-btn" onclick="deleteStudent('${s.id}')">Ø­Ø°Ù</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                studentsTable.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</p></div>';
            }

            // Teachers List
            const teachersTable = document.getElementById('teachersListTable');
            if (teachers.length > 0) {
                teachersTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„ÙƒÙˆØ¯</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„ØªØ®ØµØµ</th>
                                <th>Ø§Ø¯Ø§Ø±ÙŠ</th>
                                <th>Ø§Ù„ÙØµÙ„</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${teachers.map(t => `
                                <tr>
                                    <td><strong>${t.code}</strong></td>
                                    <td>${t.name}</td>
                                    <td>${t.phone}</td>
                                    <td>${t.specialization}</td>
                                    <td><span class="badge ${t.admin === 'TRUE' ? 'badge-success' : 'badge-danger'}">${t.admin === 'TRUE' ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</span></td>
                                    <td>${t.class}</td>
                                    <td>
                                        <button class="delete-btn" onclick="deleteTeacher('${t.id}')">Ø­Ø°Ù</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                teachersTable.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø¯Ø§Ù… Ù…Ø³Ø¬Ù„ÙŠÙ†</p></div>';
            }

            // Results Management
            const resultStudent = document.getElementById('resultStudent');
            resultStudent.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø§Ø±Ø³</option>' + 
                students.map(s => `<option value="${s.code}">${s.name} (${s.code})</option>`).join('');

            const results = DB.get('results');
            const allResultsTable = document.getElementById('allResultsTable');
            if (results.length > 0) {
                allResultsTable.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø¯Ø§Ø±Ø³</th>
                                <th>Ø§Ù„ØªØ±Ù…</th>
                                <th>Midterm</th>
                                <th>Final</th>
                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${results.map(r => `
                                <tr>
                                    <td>${r.studentName}</td>
                                    <td>${r.term}</td>
                                    <td>${r.midterm}</td>
                                    <td>${r.final}</td>
                                    <td><strong>${r.midterm + r.final}</strong></td>
                                    <td>
                                        <button class="delete-btn" onclick="deleteResult('${r.id}')">Ø­Ø°Ù</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                allResultsTable.innerHTML = '<div class="empty-state"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø³Ø¬Ù„Ø©</p></div>';
            }
        }

        document.getElementById('addStudentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const code = generateCode('');
            
            const student = DB.add('students', {
                code: code,
                studentType: document.getElementById('studentType').value,
                name: document.getElementById('studentName').value,
                gender: document.getElementById('studentGender').value,
                birthdate: document.getElementById('studentBirthdate').value,
                stage: document.getElementById('studentStage').value,
                phone1: document.getElementById('studentPhone1').value,
                phone2: document.getElementById('studentPhone2').value,
                classLetter: document.getElementById('studentClassLetter').value,
                class: document.getElementById('studentClass').value,
                rank: document.getElementById('studentRank').value,
                address: document.getElementById('studentAddress').value,
                form: document.getElementById('studentForm').value,
                photo: document.getElementById('studentPhoto').value,
                formValue: document.getElementById('studentFormValue').value
            });

            showAlert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ÙƒÙˆØ¯: ${code}`, 'success');
            this.reset();
            loadControlData();
        });

        document.getElementById('addTeacherForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const code = generateCode('');
            
            const teacher = DB.add('teachers', {
                type: 'teacher',
                code: code,
                name: document.getElementById('teacherName').value,
                phone: document.getElementById('teacherPhone').value,
                specialization: document.getElementById('teacherSpec').value,
                admin: document.getElementById('teacherAdmin').value,
                password: document.getElementById('teacherPassword').value,
                class: document.getElementById('teacherClass').value
            });

            showAlert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ÙƒÙˆØ¯: ${code}`, 'success');
            this.reset();
            loadControlData();
        });

        document.getElementById('addResultForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const studentCode = document.getElementById('resultStudent').value;
            const students = DB.get('students');
            const student = students.find(s => s.code === studentCode);

            if (!student) {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯Ø§Ø±Ø³', 'error');
                return;
            }

            DB.add('results', {
                studentCode: studentCode,
                studentName: student.name,
                term: document.getElementById('resultTerm').value,
                midterm: parseInt(document.getElementById('resultMidterm').value),
                final: parseInt(document.getElementById('resultFinal').value)
            });

            showAlert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            this.reset();
            loadControlData();
        });

        function deleteStudent(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø§Ø±Ø³ØŸ')) {
                DB.delete('students', id);
                showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadControlData();
            }
        }

        function deleteTeacher(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø®Ø§Ø¯Ù…ØŸ')) {
                DB.delete('teachers', id);
                showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadControlData();
            }
        }

        function deleteResult(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŸ')) {
                DB.delete('results', id);
                showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadControlData();
            }
        }

        // Students Export/Import Functions
        function exportStudentsToExcel() {
            const students = DB.get('students');
            if (students.length === 0) {
                showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }

            const workbook = XLSX.utils.book_new();
            const studentsData = students.map((s, index) => ({
                'Ù…': index + 1,
                'Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³': s.studentType,
                'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': s.code,
                'Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„': s.name,
                'Ø§Ù„Ù†ÙˆØ¹': s.gender,
                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯': new Date(s.birthdate).toLocaleDateString('ar-EG'),
                'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©': s.stage,
                'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1': s.phone1,
                'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2': s.phone2 || '',
                'Ø­Ø±Ù Ø§Ù„ÙØµÙ„': s.classLetter,
                'Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²': s.class,
                'Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©': s.rank || '',
                'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': s.address || '',
                'Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©': s.form,
                'Ø§Ù„ØµÙˆØ±Ø©': s.photo,
                'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©': s.formValue
            }));
            
            const studentsSheet = XLSX.utils.json_to_sheet(studentsData);
            XLSX.utils.book_append_sheet(workbook, studentsSheet, 'Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†');
            
            const fileName = `students-backup-${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            showAlert(`ØªÙ… ØªØµØ¯ÙŠØ± ${students.length} Ø¯Ø§Ø±Ø³ Ø¥Ù„Ù‰ Excel Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }

        function exportStudentsJSON() {
            const students = DB.get('students');
            if (students.length === 0) {
                showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø±Ø³ÙŠÙ† Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }

            const backup = {
                students: students,
                exportDate: new Date().toISOString(),
                count: students.length
            };

            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `students-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showAlert(`ØªÙ… ØªØµØ¯ÙŠØ± ${students.length} Ø¯Ø§Ø±Ø³ Ø¥Ù„Ù‰ JSON Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }

        function importStudentsFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});

                    if (!workbook.SheetNames.includes('Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†')) {
                        showLoading(false);
                        showAlert('Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†', 'error');
                        return;
                    }

                    if (!confirm('Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                        showLoading(false);
                        return;
                    }

                    const studentsSheet = workbook.Sheets['Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†'];
                    const studentsData = XLSX.utils.sheet_to_json(studentsSheet);
                    const students = studentsData.map(row => ({
                        id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                        studentType: row['Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                        code: row['ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                        name: row['Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„'],
                        gender: row['Ø§Ù„Ù†ÙˆØ¹'],
                        birthdate: parseExcelDate(row['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯']),
                        stage: row['Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©'],
                        phone1: row['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1'],
                        phone2: row['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2'] || '',
                        classLetter: row['Ø­Ø±Ù Ø§Ù„ÙØµÙ„'],
                        class: row['Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²'],
                        rank: row['Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©'] || '',
                        address: row['Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'] || '',
                        form: row['Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©'],
                        photo: row['Ø§Ù„ØµÙˆØ±Ø©'],
                        formValue: row['Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©']
                    }));
                    
                    DB.set('students', students);
                    showLoading(false);
                    showAlert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${students.length} Ø¯Ø§Ø±Ø³ Ù…Ù† Excel Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    setTimeout(() => loadControlData(), 1000);
                } catch (error) {
                    showLoading(false);
                    console.error(error);
                    showAlert('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…Ù„Ù Excel', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        function importStudentsFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (!backup.students || !Array.isArray(backup.students)) {
                        showLoading(false);
                        showAlert('Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø±Ø³ÙŠÙ† ØµØ­ÙŠØ­Ø©', 'error');
                        return;
                    }

                    if (!confirm(`Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ù€ ${backup.students.length} Ø¯Ø§Ø±Ø³. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ`)) {
                        showLoading(false);
                        return;
                    }

                    DB.set('students', backup.students);
                    showLoading(false);
                    showAlert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${backup.students.length} Ø¯Ø§Ø±Ø³ Ù…Ù† JSON Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    setTimeout(() => loadControlData(), 1000);
                } catch (error) {
                    showLoading(false);
                    console.error(error);
                    showAlert('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…Ù„Ù JSON', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Teachers Export/Import Functions
        function exportTeachersToExcel() {
            const teachers = DB.get('teachers').filter(t => t.type !== 'control');
            if (teachers.length === 0) {
                showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø¯Ø§Ù… Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }

            const workbook = XLSX.utils.book_new();
            const teachersData = teachers.map((t, index) => ({
                'Ù…': index + 1,
                'ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…': t.code,
                'Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…': t.name,
                'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ': t.phone,
                'Ø§Ù„ØªØ®ØµØµ': t.specialization,
                'Ø§Ø¯Ø§Ø±ÙŠ': t.admin,
                'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±': t.password,
                'Ø§Ù„ÙØµÙ„': t.class
            }));
            
            const teachersSheet = XLSX.utils.json_to_sheet(teachersData);
            XLSX.utils.book_append_sheet(workbook, teachersSheet, 'Ø§Ù„Ø®Ø¯Ø§Ù…');
            
            const fileName = `teachers-backup-${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            showAlert(`ØªÙ… ØªØµØ¯ÙŠØ± ${teachers.length} Ø®Ø§Ø¯Ù… Ø¥Ù„Ù‰ Excel Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }

        function exportTeachersJSON() {
            const teachers = DB.get('teachers').filter(t => t.type !== 'control');
            if (teachers.length === 0) {
                showAlert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø¯Ø§Ù… Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }

            const backup = {
                teachers: teachers,
                exportDate: new Date().toISOString(),
                count: teachers.length
            };

            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `teachers-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showAlert(`ØªÙ… ØªØµØ¯ÙŠØ± ${teachers.length} Ø®Ø§Ø¯Ù… Ø¥Ù„Ù‰ JSON Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }

        function importTeachersFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});

                    if (!workbook.SheetNames.includes('Ø§Ù„Ø®Ø¯Ø§Ù…')) {
                        showLoading(false);
                        showAlert('Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù…', 'error');
                        return;
                    }

                    if (!confirm('Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù…Ø§Ø¹Ø¯Ø§ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„). Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                        showLoading(false);
                        return;
                    }

                    const teachersSheet = workbook.Sheets['Ø§Ù„Ø®Ø¯Ø§Ù…'];
                    const teachersData = XLSX.utils.sheet_to_json(teachersSheet);
                    const teachers = teachersData.map(row => ({
                        id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                        type: 'teacher',
                        code: row['ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…'],
                        name: row['Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…'],
                        phone: row['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'],
                        specialization: row['Ø§Ù„ØªØ®ØµØµ'],
                        admin: row['Ø§Ø¯Ø§Ø±ÙŠ'],
                        password: row['ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'],
                        class: row['Ø§Ù„ÙØµÙ„']
                    }));
                    
                    // Keep control users
                    const controlUsers = DB.get('teachers').filter(t => t.type === 'control');
                    DB.set('teachers', [...controlUsers, ...teachers]);
                    
                    showLoading(false);
                    showAlert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${teachers.length} Ø®Ø§Ø¯Ù… Ù…Ù† Excel Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    setTimeout(() => loadControlData(), 1000);
                } catch (error) {
                    showLoading(false);
                    console.error(error);
                    showAlert('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…Ù„Ù Excel', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        function importTeachersFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (!backup.teachers || !Array.isArray(backup.teachers)) {
                        showLoading(false);
                        showAlert('Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø¯Ø§Ù… ØµØ­ÙŠØ­Ø©', 'error');
                        return;
                    }

                    if (!confirm(`Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ù€ ${backup.teachers.length} Ø®Ø§Ø¯Ù… (Ù…Ø§Ø¹Ø¯Ø§ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„). Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ`)) {
                        showLoading(false);
                        return;
                    }

                    // Keep control users
                    const controlUsers = DB.get('teachers').filter(t => t.type === 'control');
                    DB.set('teachers', [...controlUsers, ...backup.teachers]);
                    
                    showLoading(false);
                    showAlert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${backup.teachers.length} Ø®Ø§Ø¯Ù… Ù…Ù† JSON Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    setTimeout(() => loadControlData(), 1000);
                } catch (error) {
                    showLoading(false);
                    console.error(error);
                    showAlert('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…Ù„Ù JSON', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Complete Excel Export/Import Functions
        function exportToExcel() {
            const workbook = XLSX.utils.book_new();

            // Export Students
            const students = DB.get('students');
            if (students.length > 0) {
                const studentsData = students.map((s, index) => ({
                    'Ù…': index + 1,
                    'Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³': s.studentType,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': s.code,
                    'Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„': s.name,
                    'Ø§Ù„Ù†ÙˆØ¹': s.gender,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯': new Date(s.birthdate).toLocaleDateString('ar-EG'),
                    'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©': s.stage,
                    'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1': s.phone1,
                    'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2': s.phone2 || '',
                    'Ø­Ø±Ù Ø§Ù„ÙØµÙ„': s.classLetter,
                    'Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²': s.class,
                    'Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©': s.rank || '',
                    'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': s.address || '',
                    'Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©': s.form,
                    'Ø§Ù„ØµÙˆØ±Ø©': s.photo,
                    'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©': s.formValue
                }));
                const studentsSheet = XLSX.utils.json_to_sheet(studentsData);
                XLSX.utils.book_append_sheet(workbook, studentsSheet, 'Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†');
            }

            // Export Teachers
            const teachers = DB.get('teachers').filter(t => t.type !== 'control');
            if (teachers.length > 0) {
                const teachersData = teachers.map((t, index) => ({
                    'Ù…': index + 1,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…': t.code,
                    'Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…': t.name,
                    'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ': t.phone,
                    'Ø§Ù„ØªØ®ØµØµ': t.specialization,
                    'Ø§Ø¯Ø§Ø±ÙŠ': t.admin,
                    'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±': t.password,
                    'Ø§Ù„ÙØµÙ„': t.class
                }));
                const teachersSheet = XLSX.utils.json_to_sheet(teachersData);
                XLSX.utils.book_append_sheet(workbook, teachersSheet, 'Ø§Ù„Ø®Ø¯Ø§Ù…');
            }

            // Export Grades
            const grades = DB.get('grades');
            if (grades.length > 0) {
                const gradesData = grades.map((g, index) => ({
                    'Ù…': index + 1,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': g.studentCode,
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®': new Date(g.date).toLocaleDateString('ar-EG'),
                    'Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©': g.coptic || '',
                    'Ø§Ù„Ø·Ù‚ÙˆØ³': g.rituals || '',
                    'Ø§Ù„Ø£Ù„Ø­Ø§Ù†': g.hymns || ''
                }));
                const gradesSheet = XLSX.utils.json_to_sheet(gradesData);
                XLSX.utils.book_append_sheet(workbook, gradesSheet, 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª');
            }

            // Export Attendance
            const attendance = DB.get('attendance');
            if (attendance.length > 0) {
                const attendanceData = attendance.map((a, index) => ({
                    'Ù…': index + 1,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': a.studentCode,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…': a.teacherCode,
                    'Ø§Ù„Ø­Ø¶ÙˆØ±': a.attendance === 'present' ? 'Ø­Ø§Ø¶Ø±' : a.attendance === 'absent' ? 'ØºØ§Ø¦Ø¨' : 'Ù…Ø¹ØªØ°Ø±',
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®': new Date(a.date).toLocaleDateString('ar-EG')
                }));
                const attendanceSheet = XLSX.utils.json_to_sheet(attendanceData);
                XLSX.utils.book_append_sheet(workbook, attendanceSheet, 'Ø§Ù„Ø­Ø¶ÙˆØ±');
            }

            // Export Results
            const results = DB.get('results');
            if (results.length > 0) {
                const resultsData = results.map((r, index) => ({
                    'Ù…': index + 1,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': r.studentCode,
                    'Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³': r.studentName,
                    'Ø§Ù„ØªØ±Ù…': r.term,
                    'Midterm': r.midterm,
                    'Final': r.final,
                    'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹': r.midterm + r.final
                }));
                const resultsSheet = XLSX.utils.json_to_sheet(resultsData);
                XLSX.utils.book_append_sheet(workbook, resultsSheet, 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
            }

            // Export Homework
            const homework = DB.get('homework');
            if (homework.length > 0) {
                const homeworkData = homework.map((h, index) => ({
                    'Ù…': index + 1,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³': h.studentCode,
                    'Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³': h.studentName,
                    'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨': h.type === 'coptic' ? 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©' : h.type === 'rituals' ? 'Ø§Ù„Ø·Ù‚ÙˆØ³' : 'Ø§Ù„Ø£Ù„Ø­Ø§Ù†',
                    'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª': h.notes,
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®': new Date(h.date).toLocaleString('ar-EG')
                }));
                const homeworkSheet = XLSX.utils.json_to_sheet(homeworkData);
                XLSX.utils.book_append_sheet(workbook, homeworkSheet, 'Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª');
            }

            // Export Preparation
            const preparation = DB.get('preparation');
            if (preparation.length > 0) {
                const prepData = preparation.map((p, index) => ({
                    'Ù…': index + 1,
                    'ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…': p.teacherCode,
                    'Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…': p.teacherName,
                    'Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø³': p.notes,
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®': new Date(p.date).toLocaleString('ar-EG')
                }));
                const prepSheet = XLSX.utils.json_to_sheet(prepData);
                XLSX.utils.book_append_sheet(workbook, prepSheet, 'Ø§Ù„ØªØ­Ø¶ÙŠØ±');
            }

            // Save file
            const fileName = `habib-center-${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true);

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});

                    if (!confirm('Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                        showLoading(false);
                        return;
                    }

                    // Import Students
                    if (workbook.SheetNames.includes('Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†')) {
                        const studentsSheet = workbook.Sheets['Ø§Ù„Ø¯Ø§Ø±Ø³ÙŠÙ†'];
                        const studentsData = XLSX.utils.sheet_to_json(studentsSheet);
                        const students = studentsData.map(row => ({
                            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                            studentType: row['Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                            code: row['ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                            name: row['Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„'],
                            gender: row['Ø§Ù„Ù†ÙˆØ¹'],
                            birthdate: parseExcelDate(row['ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯']),
                            stage: row['Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©'],
                            phone1: row['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1'],
                            phone2: row['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2'] || '',
                            classLetter: row['Ø­Ø±Ù Ø§Ù„ÙØµÙ„'],
                            class: row['Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±ÙƒØ²'],
                            rank: row['Ø±ØªØ¨Ø© Ø§Ù„Ø´Ù…Ø§Ø³ÙŠØ©'] || '',
                            address: row['Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'] || '',
                            form: row['Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©'],
                            photo: row['Ø§Ù„ØµÙˆØ±Ø©'],
                            formValue: row['Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©']
                        }));
                        DB.set('students', students);
                    }

                    // Import Teachers
                    if (workbook.SheetNames.includes('Ø§Ù„Ø®Ø¯Ø§Ù…')) {
                        const teachersSheet = workbook.Sheets['Ø§Ù„Ø®Ø¯Ø§Ù…'];
                        const teachersData = XLSX.utils.sheet_to_json(teachersSheet);
                        const teachers = teachersData.map(row => ({
                            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                            type: 'teacher',
                            code: row['ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…'],
                            name: row['Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…'],
                            phone: row['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'],
                            specialization: row['Ø§Ù„ØªØ®ØµØµ'],
                            admin: row['Ø§Ø¯Ø§Ø±ÙŠ'],
                            password: row['ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'],
                            class: row['Ø§Ù„ÙØµÙ„']
                        }));
                        
                        // Keep control users
                        const controlUsers = DB.get('teachers').filter(t => t.type === 'control');
                        DB.set('teachers', [...controlUsers, ...teachers]);
                    }

                    // Import Grades
                    if (workbook.SheetNames.includes('Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª')) {
                        const gradesSheet = workbook.Sheets['Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª'];
                        const gradesData = XLSX.utils.sheet_to_json(gradesSheet);
                        const grades = gradesData.map(row => ({
                            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                            studentCode: row['ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                            date: parseExcelDate(row['Ø§Ù„ØªØ§Ø±ÙŠØ®']),
                            coptic: row['Ø§Ù„Ù„ØºØ© Ø§Ù„Ù‚Ø¨Ø·ÙŠØ©'] || null,
                            rituals: row['Ø§Ù„Ø·Ù‚ÙˆØ³'] || null,
                            hymns: row['Ø§Ù„Ø£Ù„Ø­Ø§Ù†'] || null
                        }));
                        DB.set('grades', grades);
                    }

                    // Import Attendance
                    if (workbook.SheetNames.includes('Ø§Ù„Ø­Ø¶ÙˆØ±')) {
                        const attendanceSheet = workbook.Sheets['Ø§Ù„Ø­Ø¶ÙˆØ±'];
                        const attendanceData = XLSX.utils.sheet_to_json(attendanceSheet);
                        const attendance = attendanceData.map(row => {
                            let status = 'present';
                            if (row['Ø§Ù„Ø­Ø¶ÙˆØ±'] === 'ØºØ§Ø¦Ø¨') status = 'absent';
                            else if (row['Ø§Ù„Ø­Ø¶ÙˆØ±'] === 'Ù…Ø¹ØªØ°Ø±') status = 'excused';
                            
                            return {
                                id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                                studentCode: row['ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                                teacherCode: row['ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…'],
                                attendance: status,
                                date: parseExcelDate(row['Ø§Ù„ØªØ§Ø±ÙŠØ®'])
                            };
                        });
                        DB.set('attendance', attendance);
                    }

                    // Import Results
                    if (workbook.SheetNames.includes('Ø§Ù„Ù†ØªØ§Ø¦Ø¬')) {
                        const resultsSheet = workbook.Sheets['Ø§Ù„Ù†ØªØ§Ø¦Ø¬'];
                        const resultsData = XLSX.utils.sheet_to_json(resultsSheet);
                        const results = resultsData.map(row => ({
                            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                            studentCode: row['ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                            studentName: row['Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³'],
                            term: row['Ø§Ù„ØªØ±Ù…'],
                            midterm: parseInt(row['Midterm']),
                            final: parseInt(row['Final'])
                        }));
                        DB.set('results', results);
                    }

                    // Import Homework
                    if (workbook.SheetNames.includes('Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª')) {
                        const homeworkSheet = workbook.Sheets['Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª'];
                        const homeworkData = XLSX.utils.sheet_to_json(homeworkSheet);
                        const homework = homeworkData.map(row => {
                            let type = 'coptic';
                            if (row['Ù†ÙˆØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨'] === 'Ø§Ù„Ø·Ù‚ÙˆØ³') type = 'rituals';
                            else if (row['Ù†ÙˆØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨'] === 'Ø§Ù„Ø£Ù„Ø­Ø§Ù†') type = 'hymns';
                            
                            return {
                                id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                                studentCode: row['ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ø±Ø³'],
                                studentName: row['Ø§Ø³Ù… Ø§Ù„Ø¯Ø§Ø±Ø³'],
                                type: type,
                                notes: row['Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª'],
                                date: parseExcelDate(row['Ø§Ù„ØªØ§Ø±ÙŠØ®'])
                            };
                        });
                        DB.set('homework', homework);
                    }

                    // Import Preparation
                    if (workbook.SheetNames.includes('Ø§Ù„ØªØ­Ø¶ÙŠØ±')) {
                        const prepSheet = workbook.Sheets['Ø§Ù„ØªØ­Ø¶ÙŠØ±'];
                        const prepData = XLSX.utils.sheet_to_json(prepSheet);
                        const preparation = prepData.map(row => ({
                            id: Date.now().toString(36) + Math.random().toString(36).substr(2),
                            teacherCode: row['ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù…'],
                            teacherName: row['Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ø¯Ù…'],
                            notes: row['Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø³'],
                            date: parseExcelDate(row['Ø§Ù„ØªØ§Ø±ÙŠØ®'])
                        }));
                        DB.set('preparation', preparation);
                    }

                    showLoading(false);
                    showAlert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Excel Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    setTimeout(() => location.reload(), 1500);
                } catch (error) {
                    showLoading(false);
                    console.error(error);
                    showAlert('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…Ù„Ù Excel', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        function parseExcelDate(dateValue) {
            if (!dateValue) return new Date().toISOString();
            
            // If it's already an ISO string
            if (typeof dateValue === 'string' && dateValue.includes('-')) {
                return new Date(dateValue).toISOString();
            }
            
            // If it's an Excel serial date
            if (typeof dateValue === 'number') {
                const excelEpoch = new Date(1899, 11, 30);
                const date = new Date(excelEpoch.getTime() + dateValue * 86400000);
                return date.toISOString();
            }
            
            // Try to parse as string
            try {
                return new Date(dateValue).toISOString();
            } catch {
                return new Date().toISOString();
            }
        }

        // Complete Backup Functions
        function exportCompleteJSON() {
            const backup = {
                students: DB.get('students'),
                teachers: DB.get('teachers'),
                grades: DB.get('grades'),
                attendance: DB.get('attendance'),
                homework: DB.get('homework'),
                preparation: DB.get('preparation'),
                results: DB.get('results'),
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `complete-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function importCompleteJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (confirm('Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                        DB.set('students', backup.students || []);
                        DB.set('teachers', backup.teachers || []);
                        DB.set('grades', backup.grades || []);
                        DB.set('attendance', backup.attendance || []);
                        DB.set('homework', backup.homework || []);
                        DB.set('preparation', backup.preparation || []);
                        DB.set('results', backup.results || []);
                        
                        showAlert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        setTimeout(() => location.reload(), 1500);
                    }
                } catch (error) {
                    showAlert('ÙØ´Ù„ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAllData() {
            if (confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
                    localStorage.clear();
                    showAlert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
                    setTimeout(() => location.reload(), 1500);
                }
            }
        }

        // Export Reports
        function exportReport(type) {
            let data = [];
            let filename = '';

            if (type === 'students') {
                data = DB.get('students');
                filename = 'students-report';
            } else if (type === 'grades') {
                data = DB.get('grades');
                filename = 'grades-report';
            } else if (type === 'attendance') {
                data = DB.get('attendance');
                filename = 'attendance-report';
            }

            if (data.length === 0) {
                showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'error');
                return;
            }

            const csv = convertToCSV(data);
            const blob = new Blob(['\ufeff' + csv], {type: 'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename}-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            URL.revokeObjectURL(url);
            showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            const headers = Object.keys(data[0]).filter(k => k !== 'id');
            const rows = data.map(obj => headers.map(h => {
                const value = obj[h] || '';
                return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
            }).join(','));
            return [headers.join(','), ...rows].join('\n');
        }

        // UI Functions
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function logout() {
            currentUser = null;
            document.querySelectorAll('.dashboard').forEach(d => d.classList.remove('active'));
            document.getElementById('loginSection').classList.add('active');
            document.getElementById('loginForm').reset();
            showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.textContent = message;
            alertBox.className = `alert alert-${type} show`;
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }

        function showLoading(show) {
            const loadingBox = document.getElementById('loadingBox');
            if (show) {
                loadingBox.classList.add('show');
            } else {
                loadingBox.classList.remove('show');
            }
        }

        // Initialize System
        initializeSystem();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99cfce335314e1ae',t:'MTc2Mjg4NTI0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
